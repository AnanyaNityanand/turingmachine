<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Finance Habit Checker (Turing Machine)</title>
<style>
  * { box-sizing: border-box; }
  body {
    font-family: "Poppins", sans-serif;
    background: linear-gradient(135deg, #6a11cb, #2575fc);
    margin: 0;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .container {
    background: white;
    width: 430px;
    max-width: 100%;
    padding: 25px 30px 20px;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
  }

  h1 {
    font-size: 20px;
    color: #333;
    text-align: center;
    margin-bottom: 10px;
  }

  p {
    font-size: 13px;
    color: #666;
    text-align: center;
  }

  .input-group {
    display: flex;
    gap: 10px;
    margin-top: 15px;
  }

  input, select {
    padding: 10px;
    border: 2px solid #ddd;
    border-radius: 10px;
    font-size: 14px;
    flex: 1;
    outline: none;
    transition: 0.3s;
  }

  input:focus, select:focus {
    border-color: #2575fc;
  }

  .btn {
    width: 100%;
    margin-top: 12px;
    padding: 10px;
    border: none;
    border-radius: 10px;
    background: #6a11cb;
    color: white;
    font-weight: bold;
    font-size: 14px;
    cursor: pointer;
    transition: 0.3s;
  }

  .btn:hover {
    background: #2575fc;
  }

  .btn-secondary {
    background: #111827;
  }

  .btn-secondary:hover {
    background: #374151;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    border-radius: 10px;
    overflow: hidden;
  }

  th, td {
    border-bottom: 1px solid #eee;
    padding: 8px;
    text-align: center;
    font-size: 12px;
  }

  th {
    background: #f5f5f5;
  }

  td.actions button {
    padding: 4px 8px;
    font-size: 11px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    margin: 0 2px;
  }

  .delete-btn { background: #fee2e2; color: #b91c1c; }
  .edit-btn { background: #dbeafe; color: #1d4ed8; }

  .result {
    margin-top: 12px;
    text-align: center;
    font-size: 15px;
    font-weight: bold;
  }

  .safe { color: #16a34a; }
  .moderate { color: #f59e0b; }
  .risk { color: #dc2626; }

  .summary {
    margin-top: 8px;
    text-align: center;
    background: #f9fafb;
    padding: 10px;
    border-radius: 10px;
    font-size: 13px;
    color: #333;
  }

  .tm-visual {
    margin-top: 10px;
    background: #eef2ff;
    border-radius: 10px;
    padding: 10px;
    font-size: 12px;
    max-height: 140px;
    overflow-y: auto;
  }

  .tm-visual h3 {
    margin: 0 0 6px;
    font-size: 13px;
    color: #4f46e5;
  }

  .badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 10px;
    margin-left: 5px;
  }

  .badge.safe { background: #dcfce7; color: #166534; }
  .badge.moderate { background: #fef3c7; color: #92400e; }
  .badge.risk { background: #fee2e2; color: #b91c1c; }

  .footer {
    text-align: center;
    font-size: 11px;
    margin-top: 10px;
    color: #888;
  }

  .top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
  }

  .link {
    font-size: 11px;
    color: #2563eb;
    cursor: pointer;
    text-decoration: underline;
  }
  .dashboard-btn {
  display: inline-block;
  background: #2563eb;
  color: white;
  padding: 8px 14px;
  border-radius: 12px;
  font-size: 13px;
  cursor: pointer;
  font-weight: 500;
  transition: 0.3s;
}

.dashboard-btn:hover {
  background: #1e40af;
  transform: translateY(-2px);
  box-shadow: 0 3px 8px rgba(0,0,0,0.2);
}


</style>
</head>
<body>

<div class="container">
  <h1>ðŸ’° Finance Habit Checker (Turing Machine)</h1>
  <p>Add your expenses and check your spending habits</p>

  <div class="top-bar">
    <span style="font-size:11px;color:#6b7280;">Frontend + Backend + TM Visualizer</span>
      <div class="dashboard-btn" onclick="goToDashboard()">
  ðŸ“Š Open Dashboard
      </div>

  </div>

  <div class="input-group">
    <select id="category">
      <option value="">Select Category</option>
      <option value="food">Food</option>
      <option value="rent">Rent</option>
      <option value="savings">Savings</option>
      <option value="groceries">Groceries</option>
      <option value="medicine">Medicine</option>
      <option value="fees">Fees</option>
      <option value="snacks">Snacks</option>
      <option value="travel">Travel</option>
      <option value="coffee">Coffee</option>
      <option value="entertainment">Entertainment</option>
      <option value="shopping">Shopping</option>
      <option value="binge">Binge</option>
      <option value="gaming">Gaming</option>
      <option value="topup">Topup</option>
      <option value="impulse">Impulse</option>
      <option value="luxury">Luxury</option>
    </select>

    <input type="number" id="amount" placeholder="Amount â‚¹">
  </div>

  <button class="btn" onclick="addExpense()">Add Expense (Tape Input)</button>
  <button class="btn btn-secondary" onclick="saveAllToBackend()">ðŸ’¾ Save to Backend</button>

  <table id="expenseTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Category</th>
        <th>Amount (â‚¹)</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button class="btn" onclick="checkFinance()">Run Turing Machine</button>

  <div id="result" class="result"></div>
  <div id="summary" class="summary"></div>

  <div class="tm-visual" id="tmVisual">
    <h3>ðŸ§  Turing Machine Transitions</h3>
    <div id="tmSteps" style="font-family: monospace;"></div>
  </div>

  <div class="footer">Built using Turing Machine concept ðŸ§  | Full Stack + Dashboard</div>
</div>

<script>
let expenses = [];
let editingIndex = -1;

const API_BASE = "http://localhost:5000/api/expenses";

function goToDashboard() {
  window.location.href = "dashboard.html";
}

function addExpense() {
  const categoryEl = document.getElementById("category");
  const amountEl = document.getElementById("amount");
  const category = categoryEl.value;
  const amount = parseFloat(amountEl.value);

  if (!category || isNaN(amount) || amount <= 0) {
    alert("Please select a valid category and enter amount.");
    return;
  }

  if (editingIndex >= 0) {
    expenses[editingIndex] = { category, amount };
    editingIndex = -1;
  } else {
    expenses.push({ category, amount });
  }

  updateTable();
  categoryEl.value = "";
  amountEl.value = "";
}

function updateTable() {
  const tbody = document.querySelector("#expenseTable tbody");
  tbody.innerHTML = "";

  expenses.forEach((exp, i) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${i + 1}</td>
      <td>${exp.category}</td>
      <td>â‚¹${exp.amount.toFixed(2)}</td>
      <td class="actions">
        <button class="edit-btn" onclick="editExpense(${i})">Edit</button>
        <button class="delete-btn" onclick="deleteExpense(${i})">Delete</button>
      </td>
    `;
    tbody.appendChild(row);
  });
}

function editExpense(index) {
  const exp = expenses[index];
  document.getElementById("category").value = exp.category;
  document.getElementById("amount").value = exp.amount;
  editingIndex = index;
}

function deleteExpense(index) {
  if (confirm("Delete this expense?")) {
    expenses.splice(index, 1);
    updateTable();
  }
}

function checkFinance() {
  if (expenses.length === 0) {
    alert("Please add at least one expense.");
    return;
  }

  const safe = ["food", "rent", "savings", "groceries", "medicine", "fees"];
  const moderate = ["snacks", "travel", "coffee", "entertainment"];
  const risk = ["shopping", "binge", "gaming", "topup", "impulse", "luxury"];

  let finalState = "START";
  let total = 0;
  let steps = [];
  let currentState = "START";

  for (let i = 0; i < expenses.length; i++) {
    const exp = expenses[i];
    const cat = exp.category.toLowerCase();
    total += exp.amount;

    let newState;
    let type;

    if (safe.includes(cat)) {
      newState = "SAFE";
      type = "safe";
    } else if (moderate.includes(cat)) {
      newState = "MODERATE";
      type = "moderate";
    } else if (risk.includes(cat)) {
      newState = "RISK";
      type = "risk";
    } else {
      newState = "MODERATE";
      type = "moderate";
    }

    steps.push({
      step: i + 1,
      from: currentState,
      to: newState,
      category: cat,
      amount: exp.amount,
      type
    });

    currentState = newState;
    finalState = newState;
  }

  const resultDiv = document.getElementById("result");
  const summaryDiv = document.getElementById("summary");
  const tmStepsDiv = document.getElementById("tmSteps");
// Apply monthly limit check (â‚¹30,000)
if (total > 30000) {
    finalState = "RISK";
    resultDiv.textContent = "ðŸš¨ DANGER: Monthly spending exceeded â‚¹30,000!";
    resultDiv.className = "result risk";
} else if (finalState === "SAFE") {
    resultDiv.textContent = "âœ… Healthy Spending â€” Financially Safe!";
    resultDiv.className = "result safe";
} else if (finalState === "MODERATE") {
    resultDiv.textContent = "âš  Moderate Spending â€” Manage Wisely.";
    resultDiv.className = "result moderate";
} else {
    resultDiv.textContent = "ðŸš¨ Risk Spending â€” Overspending Alert!";
    resultDiv.className = "result risk";
}


  summaryDiv.innerHTML = `
    ðŸ’¸ <b>Total Money Spent:</b> â‚¹${total.toFixed(2)}<br>
    ðŸ“Š <b>Final Financial State:</b> ${finalState}
  `;

  // Render TM transitions like a tape read
  tmStepsDiv.innerHTML = "";
  steps.forEach((s) => {
    const span = document.createElement("div");
    span.innerHTML = `
      Step ${s.step}: [State: ${s.from}] --( read "${s.category}", â‚¹${s.amount.toFixed(
        2
      )} )--> [State: ${s.to}]
      <span class="badge ${s.type}">${s.to}</span>
    `;
    tmStepsDiv.appendChild(span);
  });
}

async function saveAllToBackend() {
  if (expenses.length === 0) {
    alert("Add some expenses first.");
    return;
  }

  try {
    for (let exp of expenses) {
      await fetch(API_BASE + "/add", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          category: exp.category,
          amount: exp.amount
        })
      });
    }
    alert("All expenses saved to backend (MongoDB). You can view them in Dashboard.");
  } catch (err) {
    console.error(err);
    alert("Failed to save to backend. Check if server is running.");
  }
}
</script>

</body>
</html>
